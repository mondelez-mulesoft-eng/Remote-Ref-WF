<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:tracing="http://www.mulesoft.org/schema/mule/tracing" xmlns="http://www.mulesoft.org/schema/mule/core"
	xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/tracing http://www.mulesoft.org/schema/mule/tracing/current/mule-tracing.xsd">
	
	<sub-flow name="set-log-filters">	
		<set-variable variableName="messageId" value="#[attributes.headers.'message_id' default uuid()]" doc:name="Set Message ID" />
		<set-variable variableName="clientId" value="#[attributes.headers.'client_id' default 'NOT_REGISTERED']" doc:name="Set Client ID" />
		<set-variable variableName="remoteAddress" value="#[attributes.remoteAddress default 'N/A']" doc:name="Set Remote Address" />
		
		<tracing:set-logging-variable doc:name="Set Timestamp" doc:id="6072e64f-ce7a-4468-b357-56f3fabda144" variableName="timestamp" value="#[now() as Number]"/>
		<tracing:set-logging-variable doc:name="Set Source" doc:id="3a97414a-e716-4b4a-a9a6-43078b2d73a7" variableName="source" value="mule"/>
		<tracing:set-logging-variable doc:name="Set Log Type" doc:id="a75969df-174a-47ec-9fbc-73037e9b717c" variableName="logType" value="APPLICATION"/>
		<tracing:set-logging-variable doc:name="Set Environment" doc:id="7762c789-f374-41a5-bd8d-617bc43d490c" variableName="env" value="${mule.env}"/>
		<tracing:set-logging-variable doc:name="Set Application" doc:id="072f95c7-81f8-4650-bb05-bdc461530a82" variableName="application" value="${api.artifactId}"/>
		<tracing:set-logging-variable doc:name="Set Message ID" doc:id="57fe0db4-b79d-4b89-b96e-2ff5539aef69" variableName="messageId" value="#[vars.messageId]"/>
		<tracing:set-logging-variable doc:name="Set Correlation ID" doc:id="e4c338df-04c8-4dc0-8a26-70b275c52a8b" variableName="correlationId" value="#[correlationId]"/>
		<tracing:set-logging-variable doc:name="Set Client ID" doc:id="58daf2be-af38-49f5-9ad8-dd8a996cc741" variableName="clientId" value="#[vars.clientId]"/>
		<tracing:set-logging-variable doc:name="Set Remote Address" doc:id="fe4608d1-550d-4dd0-9437-7d0d226b2a10" variableName="remoteAddress" value="#[vars.remoteAddress]"/>
		<tracing:set-logging-variable doc:name="Set API Version" doc:id="4e962036-cad2-42e2-a2e0-27ea4d45f377" variableName="apiVersion" value="${api.version}"/>
	</sub-flow>
</mule>